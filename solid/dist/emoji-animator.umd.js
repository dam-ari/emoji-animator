(function(B,C){typeof exports=="object"&&typeof module<"u"?module.exports=C():typeof define=="function"&&define.amd?define(C):(B=typeof globalThis<"u"?globalThis:B||self).EmojiAnimator=C()})(this,function(){"use strict";const B={equals:(t,o)=>t===o};let C=K;const S=1,E=2,W={owned:null,cleanups:null,context:null,owner:null};var b=null;let X,P=null,v=null,y=null,w=null,j=0;function F(t,o,e){z(J(t,o,!1,S))}function Y(t,o,e){C=_;const n=J(t,o,!1,S),s=X;e&&e.render||(n.user=!0),w?w.push(n):z(n)}function D(t){if(v===null)return t();const o=v;v=null;try{return t()}finally{v=o}}function Z(){if(this.sources&&this.state)if(this.state===S)z(this);else{const t=y;y=null,q(()=>I(this),!1),y=t}if(v){const t=this.observers?this.observers.length:0;v.sources?(v.sources.push(this),v.sourceSlots.push(t)):(v.sources=[this],v.sourceSlots=[t]),this.observers?(this.observers.push(v),this.observerSlots.push(v.sources.length-1)):(this.observers=[v],this.observerSlots=[v.sources.length-1])}return this.value}function G(t,o,e){let n=t.value;return t.comparator&&t.comparator(n,o)||(t.value=o,t.observers&&t.observers.length&&q(()=>{for(let s=0;s<t.observers.length;s+=1){const r=t.observers[s],u=P&&P.running;u&&P.disposed.has(r),(u?r.tState:r.state)||(r.pure?y.push(r):w.push(r),r.observers&&Q(r)),u||(r.state=S)}if(y.length>1e6)throw y=[],new Error},!1)),o}function z(t){if(!t.fn)return;H(t);const o=j;(function(e,n,s){let r;const u=b,l=v;v=b=e;try{r=e.fn(n)}catch(i){return e.pure&&(e.state=S,e.owned&&e.owned.forEach(H),e.owned=null),e.updatedAt=s+1,R(i)}finally{v=l,b=u}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?G(e,r):e.value=r,e.updatedAt=s)})(t,t.value,o)}function J(t,o,e,n=S,s){const r={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:o,owner:b,context:b?b.context:null,pure:e};return b===null||b!==W&&(b.owned?b.owned.push(r):b.owned=[r]),r}function k(t){if(t.state===0)return;if(t.state===E)return I(t);if(t.suspense&&D(t.suspense.inFallback))return t.suspense.effects.push(t);const o=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<j);)t.state&&o.push(t);for(let e=o.length-1;e>=0;e--)if((t=o[e]).state===S)z(t);else if(t.state===E){const n=y;y=null,q(()=>I(t,o[0]),!1),y=n}}function q(t,o){if(y)return t();let e=!1;o||(y=[]),w?e=!0:w=[],j++;try{const n=t();return function(s){if(y&&(K(y),y=null),s)return;const r=w;w=null,r.length&&q(()=>C(r),!1)}(e),n}catch(n){e||(w=null),y=null,R(n)}}function K(t){for(let o=0;o<t.length;o++)k(t[o])}function _(t){let o,e=0;for(o=0;o<t.length;o++){const n=t[o];n.user?t[e++]=n:k(n)}for(o=0;o<e;o++)k(t[o])}function I(t,o){t.state=0;for(let e=0;e<t.sources.length;e+=1){const n=t.sources[e];if(n.sources){const s=n.state;s===S?n!==o&&(!n.updatedAt||n.updatedAt<j)&&k(n):s===E&&I(n,o)}}}function Q(t){for(let o=0;o<t.observers.length;o+=1){const e=t.observers[o];e.state||(e.state=E,e.pure?y.push(e):w.push(e),e.observers&&Q(e))}}function H(t){let o;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),n=t.sourceSlots.pop(),s=e.observers;if(s&&s.length){const r=s.pop(),u=e.observerSlots.pop();n<s.length&&(r.sourceSlots[u]=n,s[n]=r,e.observerSlots[n]=u)}}if(t.owned){for(o=t.owned.length-1;o>=0;o--)H(t.owned[o]);t.owned=null}if(t.cleanups){for(o=t.cleanups.length-1;o>=0;o--)t.cleanups[o]();t.cleanups=null}t.state=0}function R(t,o=b){throw function(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}(t)}function $(t,o,e){let n;const s=()=>{const u=document.createElement("template");return u.innerHTML=t,e?u.content.firstChild.firstChild:u.content.firstChild},r=o?()=>D(()=>document.importNode(n||(n=s()),!0)):()=>(n||(n=s())).cloneNode(!0);return r.cloneNode=r,r}function M(t,o,e,n,s){for(;typeof e=="function";)e=e();if(o===e)return e;const r=typeof o,u=n!==void 0;if(t=u&&e[0]&&e[0].parentNode||t,r==="string"||r==="number")if(r==="number"&&(o=o.toString()),u){let l=e[0];l&&l.nodeType===3?l.data!==o&&(l.data=o):l=document.createTextNode(o),e=T(t,e,n,l)}else e=e!==""&&typeof e=="string"?t.firstChild.data=o:t.textContent=o;else if(o==null||r==="boolean")e=T(t,e,n);else{if(r==="function")return F(()=>{let l=o();for(;typeof l=="function";)l=l();e=M(t,l,e,n)}),()=>e;if(Array.isArray(o)){const l=[],i=e&&Array.isArray(e);if(L(l,o,e,s))return F(()=>e=M(t,l,e,n,!0)),()=>e;if(l.length===0){if(e=T(t,e,n),u)return e}else i?e.length===0?V(t,l,n):function(d,a,f){let m=f.length,p=a.length,c=m,h=0,g=0,et=a[p-1].nextSibling,x=null;for(;h<p||g<c;)if(a[h]!==f[g]){for(;a[p-1]===f[c-1];)p--,c--;if(p===h){const A=c<m?g?f[g-1].nextSibling:f[c-g]:et;for(;g<c;)d.insertBefore(f[g++],A)}else if(c===g)for(;h<p;)x&&x.has(a[h])||a[h].remove(),h++;else if(a[h]===f[c-1]&&f[g]===a[p-1]){const A=a[--p].nextSibling;d.insertBefore(f[g++],a[h++].nextSibling),d.insertBefore(f[--c],A),a[p]=f[c]}else{if(!x){x=new Map;let N=g;for(;N<c;)x.set(f[N],N++)}const A=x.get(a[h]);if(A!=null)if(g<A&&A<c){let N,O=h,U=1;for(;++O<p&&O<c&&(N=x.get(a[O]))!=null&&N===A+U;)U++;if(U>A-g){const ot=a[h];for(;g<A;)d.insertBefore(f[g++],ot)}else d.replaceChild(f[g++],a[h++])}else h++;else a[h++].remove()}}else h++,g++}(t,e,l):(e&&T(t),V(t,l));e=l}else if(o.nodeType){if(Array.isArray(e)){if(u)return e=T(t,e,n,o);T(t,e,null,o)}else e!=null&&e!==""&&t.firstChild?t.replaceChild(o,t.firstChild):t.appendChild(o);e=o}}return e}function L(t,o,e,n){let s=!1;for(let r=0,u=o.length;r<u;r++){let l,i=o[r],d=e&&e[t.length];if(!(i==null||i===!0||i===!1))if((l=typeof i)=="object"&&i.nodeType)t.push(i);else if(Array.isArray(i))s=L(t,i,d)||s;else if(l==="function")if(n){for(;typeof i=="function";)i=i();s=L(t,Array.isArray(i)?i:[i],Array.isArray(d)?d:[d])||s}else t.push(i),s=!0;else{const a=String(i);d&&d.nodeType===3&&d.data===a?t.push(d):t.push(document.createTextNode(a))}}return s}function V(t,o,e=null){for(let n=0,s=o.length;n<s;n++)t.insertBefore(o[n],e)}function T(t,o,e,n){if(e===void 0)return t.textContent="";const s=n||document.createTextNode("");if(o.length){let r=!1;for(let u=o.length-1;u>=0;u--){const l=o[u];if(s!==l){const i=l.parentNode===t;r||u?i&&l.remove():i?t.replaceChild(s,l):t.insertBefore(s,e)}else r=!0}}else t.insertBefore(s,e);return[s]}var tt=$("<div class=emoji-animator><span>");return t=>{const{emojis:o,duration:e,onAnimationEnd:n,size:s="2em"}=t,r=o.length,u=e||500*r,[l,i]=function(f,m){const p={value:f,observers:null,observerSlots:null,comparator:(m=m?Object.assign({},B,m):B).equals||void 0};return[Z.bind(p),c=>(typeof c=="function"&&(c=c(p.value)),G(p,c))]}(o[0]);return Y(()=>{let f=0;const m=setInterval(()=>{f=(f+1)%r,i(o[f]),f===r-1&&n&&n()},u/r);return()=>clearInterval(m)}),d=tt(),a=d.firstChild,s!=null?d.style.setProperty("font-size",s):d.style.removeProperty("font-size"),function(f,m,p,c){if(p===void 0||c||(c=[]),typeof m!="function")return M(f,m,c,p);F(h=>M(f,m(),h,p),c)}(a,l),d;var d,a}});
