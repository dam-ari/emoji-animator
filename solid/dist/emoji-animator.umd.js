(function(B,C){typeof exports=="object"&&typeof module<"u"?module.exports=C():typeof define=="function"&&define.amd?define(C):(B=typeof globalThis<"u"?globalThis:B||self).EmojiAnimator=C()})(this,function(){"use strict";const B={equals:(t,n)=>t===n};let C=Q;const S=1,E=2,X={owned:null,cleanups:null,context:null,owner:null};var b=null;let Y,P=null,g=null,y=null,w=null,j=0;function F(t,n,e){z(K(t,n,!1,S))}function D(t,n,e){C=_;const o=K(t,n,!1,S),r=Y;e&&e.render||(o.user=!0),w?w.push(o):z(o)}function G(t){if(g===null)return t();const n=g;g=null;try{return t()}finally{g=n}}function Z(){if(this.sources&&this.state)if(this.state===S)z(this);else{const t=y;y=null,q(()=>I(this),!1),y=t}if(g){const t=this.observers?this.observers.length:0;g.sources?(g.sources.push(this),g.sourceSlots.push(t)):(g.sources=[this],g.sourceSlots=[t]),this.observers?(this.observers.push(g),this.observerSlots.push(g.sources.length-1)):(this.observers=[g],this.observerSlots=[g.sources.length-1])}return this.value}function J(t,n,e){let o=t.value;return t.comparator&&t.comparator(o,n)||(t.value=n,t.observers&&t.observers.length&&q(()=>{for(let r=0;r<t.observers.length;r+=1){const s=t.observers[r],u=P&&P.running;u&&P.disposed.has(s),(u?s.tState:s.state)||(s.pure?y.push(s):w.push(s),s.observers&&R(s)),u||(s.state=S)}if(y.length>1e6)throw y=[],new Error},!1)),n}function z(t){if(!t.fn)return;H(t);const n=j;(function(e,o,r){let s;const u=b,l=g;g=b=e;try{s=e.fn(o)}catch(i){return e.pure&&(e.state=S,e.owned&&e.owned.forEach(H),e.owned=null),e.updatedAt=r+1,V(i)}finally{g=l,b=u}(!e.updatedAt||e.updatedAt<=r)&&(e.updatedAt!=null&&"observers"in e?J(e,s):e.value=s,e.updatedAt=r)})(t,t.value,n)}function K(t,n,e,o=S,r){const s={fn:t,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:n,owner:b,context:b?b.context:null,pure:e};return b===null||b!==X&&(b.owned?b.owned.push(s):b.owned=[s]),s}function k(t){if(t.state===0)return;if(t.state===E)return I(t);if(t.suspense&&G(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<j);)t.state&&n.push(t);for(let e=n.length-1;e>=0;e--)if((t=n[e]).state===S)z(t);else if(t.state===E){const o=y;y=null,q(()=>I(t,n[0]),!1),y=o}}function q(t,n){if(y)return t();let e=!1;n||(y=[]),w?e=!0:w=[],j++;try{const o=t();return function(r){if(y&&(Q(y),y=null),r)return;const s=w;w=null,s.length&&q(()=>C(s),!1)}(e),o}catch(o){e||(w=null),y=null,V(o)}}function Q(t){for(let n=0;n<t.length;n++)k(t[n])}function _(t){let n,e=0;for(n=0;n<t.length;n++){const o=t[n];o.user?t[e++]=o:k(o)}for(n=0;n<e;n++)k(t[n])}function I(t,n){t.state=0;for(let e=0;e<t.sources.length;e+=1){const o=t.sources[e];if(o.sources){const r=o.state;r===S?o!==n&&(!o.updatedAt||o.updatedAt<j)&&k(o):r===E&&I(o,n)}}}function R(t){for(let n=0;n<t.observers.length;n+=1){const e=t.observers[n];e.state||(e.state=E,e.pure?y.push(e):w.push(e),e.observers&&R(e))}}function H(t){let n;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),o=t.sourceSlots.pop(),r=e.observers;if(r&&r.length){const s=r.pop(),u=e.observerSlots.pop();o<r.length&&(s.sourceSlots[u]=o,r[o]=s,e.observerSlots[o]=u)}}if(t.owned){for(n=t.owned.length-1;n>=0;n--)H(t.owned[n]);t.owned=null}if(t.cleanups){for(n=t.cleanups.length-1;n>=0;n--)t.cleanups[n]();t.cleanups=null}t.state=0}function V(t,n=b){throw function(o){return o instanceof Error?o:new Error(typeof o=="string"?o:"Unknown error",{cause:o})}(t)}function $(t,n,e){let o;const r=()=>{const u=document.createElement("template");return u.innerHTML=t,e?u.content.firstChild.firstChild:u.content.firstChild},s=n?()=>G(()=>document.importNode(o||(o=r()),!0)):()=>(o||(o=r())).cloneNode(!0);return s.cloneNode=s,s}function M(t,n,e,o,r){for(;typeof e=="function";)e=e();if(n===e)return e;const s=typeof n,u=o!==void 0;if(t=u&&e[0]&&e[0].parentNode||t,s==="string"||s==="number")if(s==="number"&&(n=n.toString()),u){let l=e[0];l&&l.nodeType===3?l.data!==n&&(l.data=n):l=document.createTextNode(n),e=T(t,e,o,l)}else e=e!==""&&typeof e=="string"?t.firstChild.data=n:t.textContent=n;else if(n==null||s==="boolean")e=T(t,e,o);else{if(s==="function")return F(()=>{let l=n();for(;typeof l=="function";)l=l();e=M(t,l,e,o)}),()=>e;if(Array.isArray(n)){const l=[],i=e&&Array.isArray(e);if(L(l,n,e,r))return F(()=>e=M(t,l,e,o,!0)),()=>e;if(l.length===0){if(e=T(t,e,o),u)return e}else i?e.length===0?W(t,l,o):function(d,a,f){let m=f.length,p=a.length,c=m,h=0,v=0,et=a[p-1].nextSibling,x=null;for(;h<p||v<c;)if(a[h]!==f[v]){for(;a[p-1]===f[c-1];)p--,c--;if(p===h){const A=c<m?v?f[v-1].nextSibling:f[c-v]:et;for(;v<c;)d.insertBefore(f[v++],A)}else if(c===v)for(;h<p;)x&&x.has(a[h])||a[h].remove(),h++;else if(a[h]===f[c-1]&&f[v]===a[p-1]){const A=a[--p].nextSibling;d.insertBefore(f[v++],a[h++].nextSibling),d.insertBefore(f[--c],A),a[p]=f[c]}else{if(!x){x=new Map;let N=v;for(;N<c;)x.set(f[N],N++)}const A=x.get(a[h]);if(A!=null)if(v<A&&A<c){let N,O=h,U=1;for(;++O<p&&O<c&&(N=x.get(a[O]))!=null&&N===A+U;)U++;if(U>A-v){const nt=a[h];for(;v<A;)d.insertBefore(f[v++],nt)}else d.replaceChild(f[v++],a[h++])}else h++;else a[h++].remove()}}else h++,v++}(t,e,l):(e&&T(t),W(t,l));e=l}else if(n.nodeType){if(Array.isArray(e)){if(u)return e=T(t,e,o,n);T(t,e,null,n)}else e!=null&&e!==""&&t.firstChild?t.replaceChild(n,t.firstChild):t.appendChild(n);e=n}}return e}function L(t,n,e,o){let r=!1;for(let s=0,u=n.length;s<u;s++){let l,i=n[s],d=e&&e[t.length];if(!(i==null||i===!0||i===!1))if((l=typeof i)=="object"&&i.nodeType)t.push(i);else if(Array.isArray(i))r=L(t,i,d)||r;else if(l==="function")if(o){for(;typeof i=="function";)i=i();r=L(t,Array.isArray(i)?i:[i],Array.isArray(d)?d:[d])||r}else t.push(i),r=!0;else{const a=String(i);d&&d.nodeType===3&&d.data===a?t.push(d):t.push(document.createTextNode(a))}}return r}function W(t,n,e=null){for(let o=0,r=n.length;o<r;o++)t.insertBefore(n[o],e)}function T(t,n,e,o){if(e===void 0)return t.textContent="";const r=o||document.createTextNode("");if(n.length){let s=!1;for(let u=n.length-1;u>=0;u--){const l=n[u];if(r!==l){const i=l.parentNode===t;s||u?i&&l.remove():i?t.replaceChild(r,l):t.insertBefore(r,e)}else s=!0}}else t.insertBefore(r,e);return[r]}var tt=$("<div class=emoji-animator><span>");return t=>{const{emojis:n,duration:e,onAnimationEnd:o,size:r="2em"}=t,s=n.length,u=e||500*s,[l,i]=function(f,m){const p={value:f,observers:null,observerSlots:null,comparator:(m=m?Object.assign({},B,m):B).equals||void 0};return[Z.bind(p),c=>(typeof c=="function"&&(c=c(p.value)),J(p,c))]}(n[0]);return D(()=>{let f=0;const m=setInterval(()=>{f=(f+1)%n.length,i(n[f]),f===n.length-1&&o&&o()},u/n.length);return()=>clearInterval(m)}),D(()=>{i(n[0])}),d=tt(),a=d.firstChild,r!=null?d.style.setProperty("font-size",r):d.style.removeProperty("font-size"),function(f,m,p,c){if(p===void 0||c||(c=[]),typeof m!="function")return M(f,m,c,p);F(h=>M(f,m(),h,p),c)}(a,l),d;var d,a}});
